<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="AR Code Demo">
<title>WebAR 데모 페이지</title>

<!-- Model Viewer -->
<script type="module" src="ar-render-custom13/dist/model-viewer.min.js"></script>

<!-- CSS -->
<style>
body { margin: 0; font-family: Arial, sans-serif; background: #000; color: #fff; }
#container { position: relative; width: 100vw; height: 100vh; overflow: hidden; }
#loadingIcon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; flex-direction: column; align-items: center; }
.loading { width: 50px; height: 50px; border: 5px solid #fff; border-top: 5px solid #00f; border-radius: 50%; animation: spin 1s linear infinite; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
#infotext { position: absolute; bottom: 20px; width: 100%; text-align: center; font-size: 1.2rem; }
#immersivear { position: absolute; top: 10px; right: 10px; }
button { padding: 10px 15px; font-size: 1rem; }
</style>
</head>
<body>

<!-- AR 렌더링 컨테이너 -->
<div id="container">
    <canvas width="1536" height="756"></canvas>
</div>

<!-- 로딩 UI -->
<div id="loadingIcon">
    <div class="loading"></div>
    <div id="detectionText">AR 환경 감지 중...</div>
</div>

<div id="infotext">AR을 위해 표면을 가리키세요</div>

<!-- WebXR 버튼과 모델 -->
<div id="immersivear">
    <model-viewer id="arViewer"
                  ar
                  src="https://ar-code.com/files/AR-Code-1670830082338.glb"
                  ar-modes="webxr"
                  ar-scale="auto"
                  bounds="tight"
                  enable-pan
                  reveal="manual"
                  ar-status="not-presenting">
        <button slot="ar-button"><strong>WebXR 모드 시작</strong></button>
    </model-viewer>
</div>

<!-- WebAR Slam JS 초기화 -->
<script type="module">
import { main } from './static/webar-slam-1.6.js';

document.addEventListener('DOMContentLoaded', () => {
    const container = document.getElementById('container');
    const loading = document.getElementById('loadingIcon');
    const infoText = document.getElementById('infotext');

    if (!container) {
        console.error('#container 요소가 존재하지 않습니다. WebAR 초기화 중단');
        return;
    }

    // WebAR 초기화
    try {
        main(container).then(() => {
            console.log('WebAR 초기화 완료');
            loading.style.display = 'none';  // 로딩 숨김
            infoText.textContent = 'AR 준비 완료! 화면을 터치하세요.';
        }).catch(err => {
            console.error('WebAR 초기화 중 오류 발생:', err);
            infoText.textContent = 'AR 초기화 실패';
        });
    } catch (err) {
        console.error('WebAR 호출 중 오류:', err);
        infoText.textContent = 'AR 실행 불가';
    }
});
</script>

</body>
</html>
